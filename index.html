<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registo Erros Teletrabalho</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
    <div class="container">
        <h1>REGISTO ERROS TELETRABALHO</h1>
        <form id="errorForm">
            <div class="form-row">
                <label>Data<input type="date" id="data"></label>
                <label>User<input type="text" id="user"></label>
                <label>Hora Início<input type="time" id="hora_inicio"></label>
                <label>Hora Resolução<input type="time" id="hora_fim"></label>
                <label>Evento
                    <select id="evento">
                        <option value="Aplicações">Aplicações</option>
                        <option value="OneAgentWeb">OneAgentWeb</option>
                        <option value="Luz">Luz</option>
                        <option value="Internet">Internet</option>
                        <option value="PC">PC</option>
                        <option value="VDI">VDI</option>
                    </select>
                </label>
                <label>Tipologia de Evento<input type="text" id="tipo_evento"></label>
            </div>

            <div class="form-row">
                <label>Descrição<input type="text" id="descricao"></label>
                <label>Responsabilidade
                    <select id="responsabilidade">
                        <option value="User">User</option>
                        <option value="PC">PC</option>
                        <option value="NSS">NSS</option>
                        <option value="FID">FID</option>
                        <option value="N/a">N/a</option>
                    </select>
                </label>
                <label>Causa<input type="text" id="causa"></label>
                <label>Ação Desenvolvida<input type="text" id="acao"></label>
                <label>Observações<input type="text" id="observacoes"></label>
            </div>

            <div class="button-row">
                <button type="button" onclick="salvarDados()" class="submeter"></button>
                <button type="button" onclick="exportarCSV()" class="extrair"></button>
            </div>
        </form>
    </div>

    <script>
        const SUPABASE_URL = "https://gcetkkmmyrtbyznslwca.supabase.co";
        const SUPABASE_ANON_KEY = "SUA_CHAVE_AQUI";
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function salvarDados() {
            let registro = {
                data: document.getElementById('data').value,
                user: document.getElementById('user').value,
                hora_inicio: document.getElementById('hora_inicio').value,
                hora_fim: document.getElementById('hora_fim').value,
                evento: document.getElementById('evento').value,
                tipo_evento: document.getElementById('tipo_evento').value,
                descricao: document.getElementById('descricao').value,
                responsabilidade: document.getElementById('responsabilidade').value,
                causa: document.getElementById('causa').value,
                acao: document.getElementById('acao').value,
                observacoes: document.getElementById('observacoes').value
            };

            let { data, error } = await supabase.from('registos').insert([registro]);

            if (error) {
                alert("Erro ao salvar os dados.");
            } else {
                alert("Dados salvos com sucesso!");
            }
        }

        async function exportarCSV() {
            let { data, error } = await supabase.from('registos').select('*');
            if (error) {
                alert("Erro ao exportar os dados.");
                return;
            }

            let csvContent = "data:text/csv;charset=utf-8," +
                Object.keys(data[0]).join(";") + "\n" +
                data.map(row => Object.values(row).join(";")).join("\n");

            let encodedUri = encodeURI(csvContent);
            let link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "registos.csv");
            document.body.appendChild(link);
            link.click();
        }
    </script>
</body>
</html>




