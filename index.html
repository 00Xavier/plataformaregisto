<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registo Erros Teletrabalho</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .button-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .button-row button {
            background-color: #6a408f;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 20px;
            cursor: pointer;
            width: 150px;
            white-space: nowrap;
        }

        .button-row button:hover {
            background-color: #5a347a;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>REGISTO ERROS TELETRABALHO</h1>
        </header>
        <div class="form-container">
            <form id="errorForm">
                <div class="form-row">
                    <label for="data">Data</label>
                    <input type="date" id="data">
                    
                    <label for="user">User</label>
                    <input type="text" id="user">
                    
                    <label for="hora_inicio">Hora Início</label>
                    <input type="text" id="hora_inicio" placeholder="__:__">
                    
                    <label for="hora_fim">Hora Fim</label>
                    <input type="text" id="hora_fim" placeholder="__:__">
                    
                    <label for="evento">Evento</label>
                    <select id="evento">
                        <option value="" selected disabled>Selecione...</option>
                        <option value="Aplicações">Aplicações</option>
                        <option value="OneAgentWeb">OneAgentWeb</option>
                        <option value="Luz">Luz</option>
                        <option value="Internet">Internet</option>
                        <option value="PC">PC</option>
                        <option value="VDI">VDI</option>
                    </select>
                </div>
                <div class="button-row">
                    <button type="button" onclick="salvarDados()">Salvar</button>
                    <button type="button" onclick="exportarXLSX()">Exportar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const SUPABASE_URL = "https://gcetkkmmyrtbyznslwca.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function salvarDados() {
            let registro = {
                data: document.getElementById('data').value,
                user: document.getElementById('user').value,
                hora_inicio: document.getElementById('hora_inicio').value,
                hora_fim: document.getElementById('hora_fim').value,
                evento: document.getElementById('evento').value
            };

            let { error } = await supabase.from('registos').insert([registro]);

            if (error) {
                alert("Erro ao salvar os dados.");
                console.error("Erro ao salvar:", error);
            } else {
                alert("Dados salvos com sucesso!");
                document.getElementById('errorForm').reset();
            }
        }

        async function exportarXLSX() {
            let { data, error } = await supabase.from('registos').select('*');

            if (error) {
                alert("Erro ao buscar dados do Supabase.");
                console.error("Erro ao buscar dados:", error);
                return;
            }

            let ws = XLSX.utils.json_to_sheet(data);
            let wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Registos");
            XLSX.writeFile(wb, "Registos.xlsx");
        }
    </script>
</body>
</html>




